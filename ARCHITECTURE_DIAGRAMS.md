# Architecture & Data Flow Diagrams

## System Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         CLIENT LAYER (Browser)                           â”‚
â”‚                                                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ Angular Frontend (http://localhost:4200)                            â”‚ â”‚
â”‚  â”‚                                                                      â”‚ â”‚
â”‚  â”‚  Components & Services                                             â”‚ â”‚
â”‚  â”‚  â”œâ”€ AuthComponent (Login/Register)                                â”‚ â”‚
â”‚  â”‚  â”œâ”€ LoanListComponent                                             â”‚ â”‚
â”‚  â”‚  â”œâ”€ ApplicationListComponent                                      â”‚ â”‚
â”‚  â”‚  â”œâ”€ ReportComponent                                               â”‚ â”‚
â”‚  â”‚  â””â”€ ErrorDisplayComponent                                         â”‚ â”‚
â”‚  â”‚                                                                      â”‚ â”‚
â”‚  â”‚  Core Services (Auto-configured)                                   â”‚ â”‚
â”‚  â”‚  â”œâ”€ AuthService          (login, register, logout)               â”‚ â”‚
â”‚  â”‚  â”œâ”€ LoanService          (CRUD operations)                       â”‚ â”‚
â”‚  â”‚  â”œâ”€ ReportService        (analytics data)                        â”‚ â”‚
â”‚  â”‚  â”œâ”€ ErrorHandlerService  (error broadcasting)                    â”‚ â”‚
â”‚  â”‚  â””â”€ BackendHealthService (connectivity checks)                   â”‚ â”‚
â”‚  â”‚                                                                      â”‚ â”‚
â”‚  â”‚  Interceptor Chain (Request â†’ Response)                           â”‚ â”‚
â”‚  â”‚  â”œâ”€ 1ï¸âƒ£ ErrorInterceptor    (catches errors, provides messages) â”‚ â”‚
â”‚  â”‚  â””â”€ 2ï¸âƒ£ JwtInterceptor      (adds auth header + credentials)    â”‚ â”‚
â”‚  â”‚                                                                      â”‚ â”‚
â”‚  â”‚  HTTP Client Configuration                                         â”‚ â”‚
â”‚  â”‚  â”œâ”€ Base URL: http://localhost:8080/api                          â”‚ â”‚
â”‚  â”‚  â”œâ”€ withCredentials: true (for CORS with auth)                   â”‚ â”‚
â”‚  â”‚  â”œâ”€ Authorization: Bearer <jwt_token>                            â”‚ â”‚
â”‚  â”‚  â””â”€ Content-Type: application/json                               â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â”‚ HTTP Requests (CORS enabled!)
                                    â”‚ OPTIONS (preflight)
                                    â”‚ GET, POST, PUT, DELETE, PATCH
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      GATEWAY LAYER                                        â”‚
â”‚                                                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ API Gateway (Port 8080)                                            â”‚  â”‚
â”‚  â”‚ Spring Cloud Gateway                                               â”‚  â”‚
â”‚  â”‚                                                                    â”‚  â”‚
â”‚  â”‚ Features:                                                         â”‚  â”‚
â”‚  â”‚ â”œâ”€ CORS Configuration (Allow localhost:4200)                     â”‚  â”‚
â”‚  â”‚ â”œâ”€ JWT Authentication Filter                                    â”‚  â”‚
â”‚  â”‚ â”œâ”€ Request/Response Logging                                     â”‚  â”‚
â”‚  â”‚ â”œâ”€ Rate Limiting (optional)                                     â”‚  â”‚
â”‚  â”‚ â”œâ”€ Circuit Breaker Integration                                  â”‚  â”‚
â”‚  â”‚ â””â”€ Eureka Service Discovery                                     â”‚  â”‚
â”‚  â”‚                                                                    â”‚  â”‚
â”‚  â”‚ Routes Configuration:                                            â”‚  â”‚
â”‚  â”‚ â”œâ”€ /api/auth/**           â†’ auth-service (8083)               â”‚  â”‚
â”‚  â”‚ â”œâ”€ /api/users/**          â†’ auth-service (8083)               â”‚  â”‚
â”‚  â”‚ â”œâ”€ /api/loans/**          â†’ loan-service (8085)               â”‚  â”‚
â”‚  â”‚ â”œâ”€ /api/loan-applications/** â†’ loan-application-service (8084) â”‚  â”‚
â”‚  â”‚ â”œâ”€ /api/profiles/**       â†’ profile-service (8082)            â”‚  â”‚
â”‚  â”‚ â”œâ”€ /api/notifications/**  â†’ notification-service (8086)       â”‚  â”‚
â”‚  â”‚ â””â”€ /api/reports/**        â†’ report-service (8087)             â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                  â”‚                 â”‚                 â”‚              â”‚
                  â–¼                 â–¼                 â–¼              â–¼
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚  Auth    â”‚      â”‚  Loan    â”‚      â”‚  Profile â”‚   â”‚  Report  â”‚
            â”‚ Service  â”‚      â”‚ Service  â”‚      â”‚ Service  â”‚   â”‚ Service  â”‚
            â”‚  (8083)  â”‚      â”‚  (8085)  â”‚      â”‚  (8082)  â”‚   â”‚  (8087)  â”‚
            â”‚          â”‚      â”‚          â”‚      â”‚          â”‚   â”‚          â”‚
            â”‚ CORS: âœ… â”‚      â”‚ CORS: âœ… â”‚      â”‚ CORS: âœ… â”‚   â”‚ CORS: âœ… â”‚
            â”‚ JWT: âœ…  â”‚      â”‚ JWT: âœ…  â”‚      â”‚ JWT: âœ…  â”‚   â”‚ JWT: âœ…  â”‚
            â”‚          â”‚      â”‚          â”‚      â”‚          â”‚   â”‚          â”‚
            â”‚ Endpoints:      â”‚ Endpoints:      â”‚ Endpoints:   â”‚ Endpoints:
            â”‚ - POST /login   â”‚ - GET /list    â”‚ - GET {id}   â”‚ - GET /all
            â”‚ - POST /registerâ”‚ - POST /create â”‚ - PUT {id}   â”‚ - GET /user/{id}
            â”‚ - GET /users    â”‚ - PUT /update  â”‚ - DELETE {id}â”‚ - GET /detailed
            â”‚ - GET /validate â”‚ - DELETE /{id} â”‚            â”‚ - GET /summary
            â”‚                 â”‚ - GET /my      â”‚            â”‚
            â”‚                 â”‚ - GET /emi     â”‚            â”‚
            â”‚                 â”‚ - POST /paymentâ”‚            â”‚
            â”‚                 â”‚ - POST /approveâ”‚            â”‚
            â”‚                 â”‚                 â”‚            â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚                 â”‚                 â”‚              â”‚
                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚              Service Registry (Eureka)                â”‚
        â”‚              Port 8761                                â”‚
        â”‚                                                       â”‚
        â”‚  All services register here for discovery            â”‚
        â”‚  â”œâ”€ auth-service          UP âœ…                      â”‚
        â”‚  â”œâ”€ loan-service          UP âœ…                      â”‚
        â”‚  â”œâ”€ api-gateway           UP âœ…                      â”‚
        â”‚  â”œâ”€ loan-application-service UP âœ…                   â”‚
        â”‚  â”œâ”€ profile-service       UP âœ…                      â”‚
        â”‚  â”œâ”€ notification-service  UP âœ…                      â”‚
        â”‚  â”œâ”€ report-service        UP âœ…                      â”‚
        â”‚  â””â”€ config-server         UP âœ…                      â”‚
        â”‚                                                       â”‚
        â”‚  Health checks every 30 seconds                      â”‚
        â”‚  Auto-deregistration on failure                      â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚           Data Persistence Layer                      â”‚
        â”‚                                                       â”‚
        â”‚  â”œâ”€ H2 In-Memory Database (Development)             â”‚
        â”‚  â”‚  â””â”€ All microservices connect                    â”‚
        â”‚  â”‚                                                   â”‚
        â”‚  â”œâ”€ PostgreSQL (Production)                         â”‚
        â”‚  â”‚  â””â”€ Central database                             â”‚
        â”‚  â”‚                                                   â”‚
        â”‚  â””â”€ Message Queue (Optional RabbitMQ)               â”‚
        â”‚     â””â”€ Event-driven communication                   â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Request/Response Flow - Login Scenario

```
STEP 1: User enters credentials and clicks LOGIN
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    BROWSER (Angular Frontend)                   â”‚
â”‚                                                                 â”‚
â”‚  LoginComponent.onLogin() called                               â”‚
â”‚  â””â”€ credentials: { username: "john", password: "pass123" }    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     AuthService.login()                         â”‚
â”‚                                                                 â”‚
â”‚  Creates HTTP POST request to /api/auth/login                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              ErrorInterceptor (Interceptor #1)                  â”‚
â”‚                                                                 â”‚
â”‚  Checks if request is valid                                    â”‚
â”‚  â””â”€ Request passes through                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              JwtInterceptor (Interceptor #2)                    â”‚
â”‚                                                                 â”‚
â”‚  1. Check if token exists in localStorage                      â”‚
â”‚  2. Add withCredentials: true â† IMPORTANT FOR CORS!           â”‚
â”‚  3. Add Authorization header if token exists                   â”‚
â”‚  4. Pass to HTTP handler                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Browser's Fetch API                          â”‚
â”‚                                                                 â”‚
â”‚  STEP 2: Send CORS Preflight (OPTIONS request)                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Method: OPTIONS                                         â”‚  â”‚
â”‚  â”‚ URL: http://localhost:8080/api/auth/login             â”‚  â”‚
â”‚  â”‚ Headers:                                                â”‚  â”‚
â”‚  â”‚   Origin: http://localhost:4200                       â”‚  â”‚
â”‚  â”‚   Access-Control-Request-Method: POST                 â”‚  â”‚
â”‚  â”‚   Access-Control-Request-Headers: content-type       â”‚  â”‚
â”‚  â”‚ Body: (empty)                                          â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                 â”‚
â”‚  STEP 3: If preflight OK (200), send actual request          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Method: POST                                            â”‚  â”‚
â”‚  â”‚ URL: http://localhost:8080/api/auth/login             â”‚  â”‚
â”‚  â”‚ Headers:                                                â”‚  â”‚
â”‚  â”‚   Origin: http://localhost:4200                       â”‚  â”‚
â”‚  â”‚   Content-Type: application/json                      â”‚  â”‚
â”‚  â”‚   Cookie: (if any)                                     â”‚  â”‚
â”‚  â”‚ Body: { "username": "john", "password": "pass123" }  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â–¼
                   (Network request)
                            â”‚
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    API Gateway (port 8080)                      â”‚
â”‚                                                                 â”‚
â”‚  1. Receives OPTIONS request                                   â”‚
â”‚  2. CORS filter checks origin (localhost:4200)                â”‚
â”‚  3. Returns 204 No Content with CORS headers:                 â”‚
â”‚     Access-Control-Allow-Origin: http://localhost:4200       â”‚
â”‚     Access-Control-Allow-Methods: GET, POST, ...             â”‚
â”‚     Access-Control-Allow-Headers: *                          â”‚
â”‚     Access-Control-Allow-Credentials: true                   â”‚
â”‚                                                                 â”‚
â”‚  4. Receives actual POST request                              â”‚
â”‚  5. JWT filter validates path (auth-service is public)       â”‚
â”‚  6. Routes to Auth Service (/api/auth/** â†’ :8083)            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  Auth Service (port 8083)                       â”‚
â”‚                                                                 â”‚
â”‚  1. Receives login request                                     â”‚
â”‚  2. Validates username/password                               â”‚
â”‚  3. If valid:                                                  â”‚
â”‚     - Create JWT token (HS256, secret shared with gateway)    â”‚
â”‚     - Sign with: { sub: "john", role: "CUSTOMER", exp: ... } â”‚
â”‚     - Return response with token                              â”‚
â”‚  4. If invalid:                                                â”‚
â”‚     - Return 401 Unauthorized                                 â”‚
â”‚                                                                 â”‚
â”‚  Response (200 OK):                                            â”‚
â”‚  {                                                              â”‚
â”‚    "userId": "user-123",                                       â”‚
â”‚    "username": "john",                                         â”‚
â”‚    "email": "john@example.com",                               â”‚
â”‚    "role": "CUSTOMER",                                         â”‚
â”‚    "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",      â”‚
â”‚    "accessToken": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..." â”‚
â”‚  }                                                              â”‚
â”‚                                                                 â”‚
â”‚  + CORS Response Headers:                                      â”‚
â”‚    Access-Control-Allow-Origin: http://localhost:4200        â”‚
â”‚    Access-Control-Allow-Credentials: true                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â–¼
                   (Network response)
                            â”‚
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Browser (CORS Check)                         â”‚
â”‚                                                                 â”‚
â”‚  1. Response arrives                                           â”‚
â”‚  2. Check CORS headers:                                        â”‚
â”‚     âœ… Access-Control-Allow-Origin: http://localhost:4200    â”‚
â”‚     âœ… Access-Control-Allow-Credentials: true               â”‚
â”‚  3. CORS check passes! ğŸ‰                                      â”‚
â”‚  4. Pass response to interceptors                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           JwtInterceptor (handles response)                     â”‚
â”‚                                                                 â”‚
â”‚  1. Response passes through                                    â”‚
â”‚  2. Return to Angular                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          ErrorInterceptor (checks for errors)                   â”‚
â”‚                                                                 â”‚
â”‚  1. Status 200 = success, no error                            â”‚
â”‚  2. Response passes through                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  AuthService.login() continued                  â”‚
â”‚                                                                 â”‚
â”‚  1. Receive response                                           â”‚
â”‚  2. Extract token                                              â”‚
â”‚  3. Store in localStorage:                                     â”‚
â”‚     - jwt_token: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."  â”‚
â”‚     - current_user: { userId, username, role, email }        â”‚
â”‚  4. Update BehaviorSubject (currentUserSubject)              â”‚
â”‚  5. Show success message via ErrorHandlerService             â”‚
â”‚  6. Return response to component                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚               LoginComponent (in subscribe block)              â”‚
â”‚                                                                 â”‚
â”‚  next: (response) => {                                         â”‚
â”‚    console.log('Login successful!');                          â”‚
â”‚    // Router navigates to dashboard                           â”‚
â”‚  }                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â–¼
                   ğŸ‰ LOGIN COMPLETE! ğŸ‰

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

NEXT REQUEST: Now when user accesses protected endpoint...

All requests will include token automatically:

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Every HTTP Request (from this point on)                        â”‚
â”‚                                                                 â”‚
â”‚  JwtInterceptor will:                                          â”‚
â”‚  1. Get token from localStorage                               â”‚
â”‚  2. Add Authorization: Bearer <token>                         â”‚
â”‚  3. Add withCredentials: true                                 â”‚
â”‚  4. Send request                                              â”‚
â”‚                                                                 â”‚
â”‚  API Gateway will:                                             â”‚
â”‚  1. Validate JWT using same secret                           â”‚
â”‚  2. Extract user info from token                             â”‚
â”‚  3. Add headers for downstream services:                      â”‚
â”‚     - X-User-Id: user-123                                    â”‚
â”‚     - X-User-Role: CUSTOMER                                  â”‚
â”‚     - X-User-Name: john                                      â”‚
â”‚  4. Forward to appropriate service                           â”‚
â”‚                                                                 â”‚
â”‚  Service will:                                                 â”‚
â”‚  1. Check authorization rules                                â”‚
â”‚  2. Process request                                          â”‚
â”‚  3. Return response with CORS headers                        â”‚
â”‚  4. No errors! âœ…                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Error Handling Flow

```
ANY ERROR OCCURS (4xx, 5xx, Network, etc.)
        â”‚
        â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  ErrorInterceptor catches it                â”‚
    â”‚                                             â”‚
    â”‚  error: HttpErrorResponse {                 â”‚
    â”‚    status: 401,                             â”‚
    â”‚    statusText: "Unauthorized",              â”‚
    â”‚    error: { message: "Invalid token" }      â”‚
    â”‚  }                                          â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  Determine error type                       â”‚
    â”‚                                             â”‚
    â”‚  â”œâ”€ status === 0                           â”‚
    â”‚  â”‚  â””â”€ "Network error or CORS issue..."   â”‚
    â”‚  â”‚                                         â”‚
    â”‚  â”œâ”€ status === 400                         â”‚
    â”‚  â”‚  â””â”€ "Bad request - check input..."     â”‚
    â”‚  â”‚                                         â”‚
    â”‚  â”œâ”€ status === 401                         â”‚
    â”‚  â”‚  â””â”€ "Session expired - login again"    â”‚
    â”‚  â”‚                                         â”‚
    â”‚  â”œâ”€ status === 403                         â”‚
    â”‚  â”‚  â””â”€ "No permission for this action"    â”‚
    â”‚  â”‚                                         â”‚
    â”‚  â”œâ”€ status === 404                         â”‚
    â”‚  â”‚  â””â”€ "Resource not found"               â”‚
    â”‚  â”‚                                         â”‚
    â”‚  â”œâ”€ status === 500                         â”‚
    â”‚  â”‚  â””â”€ "Server error - try later"         â”‚
    â”‚  â”‚                                         â”‚
    â”‚  â””â”€ status === 503                         â”‚
    â”‚     â””â”€ "Service unavailable"               â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  Log detailed error for debugging           â”‚
    â”‚                                             â”‚
    â”‚  {                                          â”‚
    â”‚    status: 401,                             â”‚
    â”‚    statusText: "Unauthorized",              â”‚
    â”‚    message: "Session expired...",          â”‚
    â”‚    url: "/api/loans",                       â”‚
    â”‚    response: { message: "Invalid token" }  â”‚
    â”‚  }                                          â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  Return structured error to service         â”‚
    â”‚                                             â”‚
    â”‚  {                                          â”‚
    â”‚    message: "Session expired - login...",  â”‚
    â”‚    status: 401,                             â”‚
    â”‚    originalError: HttpErrorResponse         â”‚
    â”‚  }                                          â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  Service receives error in catchError()     â”‚
    â”‚                                             â”‚
    â”‚  catchError(error => {                      â”‚
    â”‚    this.errorHandler.handleError(error)    â”‚
    â”‚    throw error  // Re-throw to component   â”‚
    â”‚  })                                         â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  ErrorHandlerService.handleError()          â”‚
    â”‚                                             â”‚
    â”‚  1. Create AppError object                  â”‚
    â”‚  2. Log to console for debugging            â”‚
    â”‚  3. Broadcast via errorSubject.next()      â”‚
    â”‚  4. All subscribers notified                â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  Component receives error via observable    â”‚
    â”‚                                             â”‚
    â”‚  this.errorHandler.error$.subscribe(err => â”‚
    â”‚    this.errorMessage = err?.message       â”‚
    â”‚  )                                          â”‚
    â”‚                                             â”‚
    â”‚  // error$ used in template with async     â”‚
    â”‚  <div *ngIf="error$ | async as error">    â”‚
    â”‚    <p>{{ error.message }}</p>              â”‚
    â”‚  </div>                                     â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  User sees friendly error message!          â”‚
    â”‚                                             â”‚
    â”‚  âŒ "Session expired - login again"        â”‚
    â”‚                                             â”‚
    â”‚  NOT:                                       â”‚
    â”‚  âœ— "HttpErrorResponse 401 Unauthorized"   â”‚
    â”‚  âœ— "Cannot read property 'xyz'"           â”‚
    â”‚  âœ— Browser error/exception                 â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Component Integration Example

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          LoanListComponent                             â”‚
â”‚                                                        â”‚
â”‚  class LoanListComponent implements OnInit {           â”‚
â”‚    loans$: Observable<Loan[]>;                         â”‚
â”‚    error$ = this.errorHandler.error$;                â”‚
â”‚    success$ = this.errorHandler.success$;            â”‚
â”‚                                                        â”‚
â”‚    constructor(                                       â”‚
â”‚      private loanService: LoanService,               â”‚
â”‚      private errorHandler: ErrorHandlerService       â”‚
â”‚    ) {}                                               â”‚
â”‚                                                        â”‚
â”‚    ngOnInit() {                                       â”‚
â”‚      this.loans$ = this.loanService.getAll();        â”‚
â”‚    }                                                  â”‚
â”‚                                                        â”‚
â”‚    delete(id: string) {                              â”‚
â”‚      this.loanService.delete(id).subscribe(         â”‚
â”‚        () => {                                        â”‚
â”‚          this.errorHandler.showSuccess(             â”‚
â”‚            'Loan deleted successfully'              â”‚
â”‚          );                                          â”‚
â”‚          this.loans$ = this.loanService.getAll();   â”‚
â”‚        }                                             â”‚
â”‚      );                                              â”‚
â”‚    }                                                  â”‚
â”‚  }                                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          Template (loan-list.component.html)          â”‚
â”‚                                                        â”‚
â”‚  <!-- Success message -->                             â”‚
â”‚  <div *ngIf="(success$ | async) as msg"             â”‚
â”‚       class="alert alert-success">                  â”‚
â”‚    {{ msg }}                                          â”‚
â”‚  </div>                                               â”‚
â”‚                                                        â”‚
â”‚  <!-- Error message -->                              â”‚
â”‚  <div *ngIf="(error$ | async) as error"             â”‚
â”‚       class="alert alert-danger">                   â”‚
â”‚    <h5>{{ error.message }}</h5>                     â”‚
â”‚    <button (click)="errorHandler.clearError()">    â”‚
â”‚      Dismiss                                          â”‚
â”‚    </button>                                          â”‚
â”‚  </div>                                               â”‚
â”‚                                                        â”‚
â”‚  <!-- Loading state -->                              â”‚
â”‚  <div *ngIf="!(loans$ | async) as loans"            â”‚
â”‚       class="spinner">                              â”‚
â”‚    Loading loans...                                  â”‚
â”‚  </div>                                               â”‚
â”‚                                                        â”‚
â”‚  <!-- Data table -->                                 â”‚
â”‚  <table *ngIf="loans && loans.length > 0">          â”‚
â”‚    <thead>                                           â”‚
â”‚      <tr>                                            â”‚
â”‚        <th>Loan ID</th>                             â”‚
â”‚        <th>Amount</th>                              â”‚
â”‚        <th>Status</th>                              â”‚
â”‚        <th>Actions</th>                             â”‚
â”‚      </tr>                                           â”‚
â”‚    </thead>                                          â”‚
â”‚    <tbody>                                           â”‚
â”‚      <tr *ngFor="let loan of loans">                â”‚
â”‚        <td>{{ loan.loanId }}</td>                   â”‚
â”‚        <td>{{ loan.amount | currency }}</td>       â”‚
â”‚        <td>{{ loan.status }}</td>                   â”‚
â”‚        <td>                                          â”‚
â”‚          <button (click)="delete(loan.loanId)">    â”‚
â”‚            Delete                                    â”‚
â”‚          </button>                                   â”‚
â”‚        </td>                                         â”‚
â”‚      </tr>                                           â”‚
â”‚    </tbody>                                          â”‚
â”‚  </table>                                            â”‚
â”‚                                                        â”‚
â”‚  <!-- No data -->                                    â”‚
â”‚  <div *ngIf="loans && loans.length === 0"          â”‚
â”‚       class="alert alert-info">                    â”‚
â”‚    No loans found                                    â”‚
â”‚  </div>                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## CORS Preflight Cache

```
First Request to an endpoint:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Browser                                              â”‚
â”‚                                                      â”‚
â”‚ 1. Check cache for CORS preflight                  â”‚
â”‚    Cache empty? â†’ Send OPTIONS request             â”‚
â”‚                                                      â”‚
â”‚ 2. Send OPTIONS (preflight)                        â”‚
â”‚    â”œâ”€ Method: OPTIONS                              â”‚
â”‚    â”œâ”€ Headers: Origin, Access-Control-Request-*   â”‚
â”‚    â””â”€ Response: CORS headers + Cache-Control       â”‚
â”‚                                                      â”‚
â”‚ 3. Backend response includes:                       â”‚
â”‚    Access-Control-Max-Age: 3600 (1 hour)          â”‚
â”‚                                                      â”‚
â”‚ 4. Browser caches this for 1 hour                 â”‚
â”‚                                                      â”‚
â”‚ 5. Send actual request (POST/PUT/etc.)            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Next 3599 seconds (within 1 hour):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Browser                                              â”‚
â”‚                                                      â”‚
â”‚ 1. Check cache                                      â”‚
â”‚    Cache found? â†’ Skip OPTIONS request             â”‚
â”‚                                                      â”‚
â”‚ 2. Send actual request directly                    â”‚
â”‚    â”œâ”€ Method: POST/PUT/DELETE/etc.                â”‚
â”‚    â”œâ”€ Includes credentials (withCredentials: true) â”‚
â”‚    â””â”€ Includes Authorization header                â”‚
â”‚                                                      â”‚
â”‚ 3. Get response immediately                        â”‚
â”‚                                                      â”‚
â”‚ Result: 1 request instead of 2!                   â”‚
â”‚ Performance: âš¡ Much faster                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Security Token Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Login Response (Auth Service sends JWT)                 â”‚
â”‚                                                         â”‚
â”‚ {                                                       â”‚
â”‚   "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9      â”‚
â”‚              .eyJzdWIiOiJ1c2VyLTEyMyIsIm5hbWUiOiJqb   â”‚
â”‚              ."                                         â”‚
â”‚ }                                                       â”‚
â”‚                                                         â”‚
â”‚ JWT Structure:                                          â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚ â”‚   Header    â”‚     Payload     â”‚  Signature   â”‚       â”‚
â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤       â”‚
â”‚ â”‚ alg: HS256  â”‚ sub: user-123   â”‚ Hash(header. â”‚       â”‚
â”‚ â”‚ typ: JWT    â”‚ role: CUSTOMER  â”‚ payload,    â”‚       â”‚
â”‚ â”‚             â”‚ exp: timestamp  â”‚ secret)     â”‚       â”‚
â”‚ â”‚             â”‚ iat: timestamp  â”‚              â”‚       â”‚
â”‚ â”‚             â”‚ nbf: timestamp  â”‚              â”‚       â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Client stores token                                     â”‚
â”‚                                                         â”‚
â”‚ localStorage {                                          â”‚
â”‚   'jwt_token': 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..â”‚
â”‚   'current_user': {                                     â”‚
â”‚     'userId': 'user-123',                              â”‚
â”‚     'username': 'john',                                â”‚
â”‚     'role': 'CUSTOMER'                                 â”‚
â”‚   }                                                     â”‚
â”‚ }                                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Each API request includes token                         â”‚
â”‚                                                         â”‚
â”‚ Headers {                                               â”‚
â”‚   'Authorization': 'Bearer eyJhbGciOiJIUzI1NiIsInR5cC..â”‚
â”‚   'Cookie': (if withCredentials: true)                â”‚
â”‚ }                                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ API Gateway validates token                             â”‚
â”‚                                                         â”‚
â”‚ 1. Extract token from Authorization header            â”‚
â”‚ 2. Verify signature using same secret                 â”‚
â”‚    (must match what Auth Service used!)               â”‚
â”‚ 3. Check expiration (exp claim)                       â”‚
â”‚ 4. If valid:                                          â”‚
â”‚    - Decode token                                     â”‚
â”‚    - Extract user info                               â”‚
â”‚    - Add headers for downstream:                      â”‚
â”‚      - X-User-Id: user-123                          â”‚
â”‚      - X-User-Role: CUSTOMER                         â”‚
â”‚      - X-User-Name: john                            â”‚
â”‚    - Forward to service                              â”‚
â”‚ 5. If invalid:                                        â”‚
â”‚    - Return 401 Unauthorized                         â”‚
â”‚    - Client logout                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Microservice receives request                           â”‚
â”‚                                                         â”‚
â”‚ 1. JWT already validated by gateway                   â”‚
â”‚ 2. User info in headers:                              â”‚
â”‚    - X-User-Id                                        â”‚
â”‚    - X-User-Role                                      â”‚
â”‚    - X-User-Name                                      â”‚
â”‚ 3. Apply @PreAuthorize checks:                        â”‚
â”‚    @PreAuthorize("hasRole('CUSTOMER')")              â”‚
â”‚ 4. Process request                                    â”‚
â”‚ 5. Return response                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Performance Optimization

```
CORS Preflight Caching (1 hour):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Request 1  â”‚ OPTIONS + POST  â”‚ 2 requests â”‚
â”‚  Request 2  â”‚ POST            â”‚ 1 request  â”‚ âœ¨
â”‚  Request 3  â”‚ POST            â”‚ 1 request  â”‚ âœ¨
â”‚  Request 4  â”‚ POST            â”‚ 1 request  â”‚ âœ¨
â”‚  ...        â”‚ ...             â”‚ 1 request  â”‚ âœ¨
â”‚  1 hour     â”‚ (cache expires) â”‚           â”‚
â”‚  Request N+1â”‚ OPTIONS + POST  â”‚ 2 requests â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Result: ~95% fewer requests to same endpoint!
```

---

**All diagrams are accurate and up-to-date!** âœ…

For implementation details, see the code files or comprehensive guides.
